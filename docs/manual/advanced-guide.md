# Tally Node 고급 설정 가이드

<!-- FEAT-MANUAL-ADVANCED -->
<!-- AUD-MANUAL-ADVANCED -->

## 목차

1. [LoRa RF 파라미터](#1-lora-rf-파라미터)
2. [네트워크 고급 설정](#2-네트워크-고급-설정)
3. [라이선스 관리](#3-라이선스-관리)
4. [업데이트 및 유지보수](#4-업데이트-및-유지보수)

---

## 1. LoRa RF 파라미터

### 1.1 주파수 대역 선택

> **경고**: 반드시 사용 국가의 허용 주파수를 사용하세요. 불법 주파수 사용 시 법적 제재가 있을 수 있습니다.

**국가별 허용 대역:**

| 국가 | 주파수 (MHz) | 대역폭 | 최대 전력 |
|------|--------------|--------|-----------|
| **한국** | 923.1 ~ 923.3 | 200 kHz | 20 dBm |
| **미국** | 915 ~ 928 | 13 MHz | 20 dBm |
| **유럽** | 868 ~ 868.6 | 600 kHz | 14 dBm |
| **일본** | 920.5 ~ 923.5 | 3 MHz | 13 dBm |
| **호주** | 915 ~ 928 | 13 MHz | 30 dBm |
| **브라질** | 915 ~ 928 | 13 MHz | 20 dBm |

**채널 할당:**

한국의 경우 200kHz 대역폭 내에서 다음 채널을 사용할 수 있습니다:

| 채널 | 주파수 (MHz) | 용도 |
|------|--------------|------|
| CH 1 | 923.1 | 기본 채널 |
| CH 2 | 923.2 | 간섭 시 대안 |
| CH 3 | 923.3 | 간섭 시 대안 |

### 1.2 SF/BW/CR 최적화

**트레이드오프 분석:**

| 파라미터 | 증가 시 효과 | 감소 시 효과 |
|----------|--------------|--------------|
| **SF** | 거리 증가, 속도 감소 | 거리 감소, 속도 증가 |
| **BW** | 속도 증가, 거리 감소 | 속도 감소, 거리 증가 |
| **CR** | 신뢰성 증가, 속도 감소 | 신뢰성 감소, 속도 증가 |

**시나리오별 권장 설정:**

#### 시나리오 A: 실내 스튜디오 (단거리, 고속)

| 파라미터 | 값 | 이유 |
|----------|-----|------|
| SF | 7 | 최대 전송 속도 |
| BW | 500 kHz | 고속 데이터 전송 |
| CR | 4/5 | 최소 오버헤드 |
| **전송 속도** | ~21 kbps | 빠른 Tally 업데이트 |
| **예상 거리** | ~50m | 실내 충분 |

#### 시나리오 B: 야외 행사 (중거리, 균형)

| 파라미터 | 값 | 이유 |
|----------|-----|------|
| SF | 9 | 균형 잡힌 성능 |
| BW | 250 kHz | 속도와 거리 균형 |
| CR | 4/5 | 최소 오버헤드 |
| **전송 속도** | ~6 kbps | 충분한 Tally 업데이트 |
| **예상 거리** | ~200m | 일반적 야외 행사 |

#### 시나리오 C: 대규모 행사 (장거리, 신뢰성)

| 파라미터 | 값 | 이유 |
|----------|-----|------|
| SF | 11 | 최대 감도 |
| BW | 125 kHz | 최대 거리 |
| CR | 4/6 | 오류 정정 강화 |
| **전송 속도** | ~1 kbps | 느리지만 신뢰성 높음 |
| **예상 거리** | ~500m | 최대 통신 거리 |

### 1.3 통신 거리 최적화

**거리에 영향을 미치는 요인:**

1. **송신 전력** (dBm)
   - 2 dBm: ~50m
   - 10 dBm: ~150m
   - 17 dBm: ~300m
   - 20 dBm: ~500m

2. **안테나**
   - 내장 안테나: 표준 성능
   - 외부 안테나: +3~6 dB 이득
   - 방향성 안테나: +10~15 dB 이득

3. **환경**
   - 개방 공간: 최대 거리
   - 실내 (벽 없음): -20%
   - 실내 (벽 있음): -50%
   - 도심 (빌딩): -70%

**최적화 팁:**

| 상황 | 해결 |
|------|------|
| 거리 부족 | SF 증가, 송신 전력 증가 |
| 간섭 문제 | 주파수 변경, BW 감소 |
| 데이터 속도 부족 | SF 감소, BW 증가 |

---

## 2. 네트워크 고급 설정

### 2.1 고정 IP 설정

**고정 IP가 필요한 경우:**

- mDNS가 작동하지 않는 환경
- 방화벽 규칙이 있는 환경
- 여러 대의 TX 장치 운영

**웹 UI에서 설정:**

1. **[설정]** > **[네트워크]** 탭으로 이동합니다
2. **IP 할당 방법**에서 **고정**을 선택합니다
3. 다음 값을 입력합니다:
   - IP 주소: `192.168.1.100` (예시)
   - 서브넷 마스크: `255.255.255.0`
   - 게이트웨이: `192.168.1.1`
   - DNS: `192.168.1.1` 또는 `8.8.8.8`
4. **[저장]** 후 재시작

**NVS/CODE 설정:**

```cpp
// main.cpp
#define STATIC_IP      "192.168.1.100"
#define STATIC_GW      "192.168.1.1"
#define STATIC_MASK    "255.255.255.0"
#define STATIC_DNS     "192.168.1.1"
```

### 2.2 DNS 설정

**사용자 정의 DNS가 필요한 경우:**

- 기업 네트워크 환경
- 특정 DNS 캐싱 서버 사용
- 로컬 도메인 확인

**공개 DNS 서버:**

| DNS | IP 주소 | 특징 |
|-----|---------|------|
| **Google** | 8.8.8.8, 8.8.4.4 | 빠르고 안정적 |
| **Cloudflare** | 1.1.1.1 | 프라이버시 중시 |
| **Quad9** | 9.9.9.9 | 보안 기능 포함 |

**설정 방법:**

1. **[설정]** > **[네트워크]** > **DNS**
2. 기본 DNS: `8.8.8.8`
3. 보조 DNS: `8.8.4.4`
4. **[저장]** 후 재시작

### 2.3 mDNS 설정

**mDNS 활성화/비활성화:**

mDNS(Multicast DNS)는 로컬 네트워크에서 호스트 이름 확인을 위한 프로토콜입니다.

**활성화 (기본값):**
- 장치 이름: `tallynode-tx.local`, `tallynode-rx.local`
- 브라우저에서 `http://tallynode-tx.local`로 접속 가능

**비활성화:**
- 일부 기업 네트워크에서 mDNS가 차단될 수 있음
- 비활성화 시 고정 IP 사용 필요

**설정:**

```
설정 > 네트워크 > mDNS: [켬/끔]
```

---

## 3. 라이선스 관리

### 3.1 라이선스 등록

Tally Node는 상업적 사용 시 라이선스가 필요합니다.

**라이선스 유형:**

| 라이선스 | 가격 | RX 장치 수 | 용도 |
|----------|------|------------|------|
| **Personal** | 무료 | 최대 3대 | 개인 사용, 비상업 |
| **Studio** | $99 | 최대 10대 | 소규모 스튜디오 |
| **Broadcast** | $299 | 최대 20대 | 방송국, 대규모 |
| **Enterprise** | 문의 | 무제한 | 기업, OEM |

**등록 단계:**

1. **라이선스 키 발급**
   - https://tally-node.com/license 에서 구매
   - 이메일로 라이선스 키 수신

2. **웹 UI에서 등록**
   - **[설정]** > **[라이선스]** 탭
   - 라이선스 키 입력
   - **[등록]** 클릭
   - 성공 메시지 확인

3. **활성화 확인**
   - **[라이선스 정보]**에서 상태 확인
   - 유효 기간, 장치 수 제한 확인

### 3.2 라이선스 확인

**확인 방법:**

1. **웹 UI**
   - 대시보드 하단에 라이선스 유형 표시
   - **[설정]** > **[라이선스]**에서 상세 정보

2. **시리얼 모니터**
   ```
   License: Studio (Valid)
   Devices: 5/10 activated
   Expiry: 2027-01-19
   ```

### 3.3 디바이스 제한

**장치 등록:**

각 라이선스는 최대 RX 장치 수를 제한합니다.

**등록 단계:**

1. RX 장치를 TX에 연결합니다
2. 웹 UI에서 **[장치 관리]** 탭
3. **[장치 등록]** 클릭
4. 장치 ID 및 MAC 주소가 자동으로 등록됩니다

**장치 해제:**

1. **[장치 관리]**에서 목록 확인
2. 해제할 장치 선택
3. **[해제]** 클릭

> **주의**: 장치 등록/해제는 30일에 5회로 제한됩니다.

---

## 4. 업데이트 및 유지보수

### 4.1 펌웨어 업데이트

**OTA (Over-The-Air) 업데이트:**

웹 UI를 통해 무선으로 펌웨어를 업데이트할 수 있습니다.

**업데이트 단계:**

1. **업데이트 확인**
   - 웹 UI 대시보드에서 **[업데이트]** 버튼 확인
   - 새 버전이 있으면 알림 표시

2. **업데이트 다운로드**
   - **[다운로드]** 클릭
   - 진행률 표시 (약 5분)

3. **업데이트 설치**
   - **[설치]** 클릭
   - 장치가 자동으로 재시작됩니다
   - 업데이트 완료 메시지 확인

**수동 업데이트 (PlatformIO):**

```bash
# 최신 소스 가져오기
git pull origin main

# 빌드 및 업로드
pio run --target upload --environment tx
# 또는
pio run --target upload --environment rx
```

**주의사항:**

> **경고**: 업데이트 중 전원을 끄지 마세요. 펌웨어 손상이 발생할 수 있습니다.

- 업데이트 전 배터리를 50% 이상 충전하세요
- 업데이트 중 장치를 이동하지 마세요
- 업데이트가 실패하면 [문제 해결 가이드](troubleshooting-guide.md)를 참조하세요

### 4.2 설정 백업/복원

**설정 백업:**

1. **[설정]** > **[백업]** 탭
2. **[백업 생성]** 클릭
3. `tallynode-config-backup-YYYYMMDD.json` 파일 다운로드

**설정 복원:**

1. **[설정]** > **[백업]** 탭
2. **[파일 선택]**으로 백업 파일 선택
3. **[복원]** 클릭
4. 장치가 재시작되고 설정이 적용됩니다

**백업 파일 내용:**

```json
{
  "version": "1.0.0",
  "date": "2026-01-19",
  "wifi": {
    "ssid": "YourWiFi",
    "ip_mode": "dhcp"
  },
  "switcher": {
    "type": "ATEM",
    "ip": "192.168.10.240"
  },
  "lora": {
    "frequency": 923,
    "sf": 9,
    "bw": 250,
    "cr": "4/5",
    "power": 17
  },
  "license": "XXXX-YYYY-ZZZZ"
}
```

### 4.3 로그 확인

**로그 레벨:**

| 레벨 | 설명 | 사용 시점 |
|------|------|-----------|
| **ERROR** | 오류만 | 프로덕션 환경 |
| **WARN** | 경고 및 오류 | 일반 운영 |
| **INFO** | 정보 | 디버깅 필요 시 |
| **DEBUG** | 상세 디버그 | 개발 중 |
| **VERBOSE** | 모든 정보 | 심층 분석 |

**로그 확인 방법:**

#### 방법 1: 시리얼 모니터

```bash
pio device monitor --baud 115200
```

#### 방법 2: 웹 UI

1. **[설정]** > **[로그]** 탭
2. 실시간 로그 스트리밍
3. **[다운로드]**로 로그 파일 저장

#### 방법 3: syslog 서버

1. **[설정]** > **[로그]** > **[Syslog]**
2. Syslog 서버 주소 입력
3. 로그가 원격 서버로 전송됩니다

**로그 분석:**

일반적인 로그 메시지:

```
[INFO] Tally Node TX v1.0.0
[INFO] LoRa initialized: SX1262, 923 MHz, SF9
[INFO] Connecting to WiFi: YourWiFi
[INFO] WiFi connected: 192.168.1.100
[INFO] Web server started on port 80
[INFO] ATEM connected: 192.168.10.240
[DEBUG] Tally changed: Ch1=Program, Ch2=Preview
```

오류 로그:

```
[ERROR] LoRa init failed: Module not detected
[WARN] WiFi connection lost, reconnecting...
[ERROR] ATEM connection timeout
```

---

## 다음 단계

- [ ] [TX 모드 가이드](tx-mode-guide.md) - 기본 사용법
- [ ] [RX 모드 가이드](rx-mode-guide.md) - 카메라맨 사용법
- [ ] [문제 해결 가이드](troubleshooting-guide.md) - 문제 해결

---

## 추가 자료

**LoRa 계산기:**
- https://www.rfwireless-world.com/calculators/LoRa-Spread-Spectrum-Calculator.html

**RF 이론:**
- https://www.semtech.com/uploads/documents/SX1262_Data_Sheet.pdf

**ESP32-S3 기술 문서:**
- https://www.espressif.com/en/products/socs/esp32-s3

---

## 추가 지원

매뉴얼에 대한 피드백이나 추가 지원이 필요하시면:
- **GitHub Issues**: https://github.com/your-repo/tally-node/issues
- **디스코드 커뮤니티**: https://discord.gg/tally-node

---

**문서 버전**: 1.0.0
**최종 업데이트**: 2026-01-19
**작성자**: Tally Node 팀
