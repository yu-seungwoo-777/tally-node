# Tally Node 설치 및 초기 설정 가이드

<!-- FEAT-MANUAL-INSTALL -->
<!-- AUD-MANUAL-BEGINNER -->
<!-- AUD-MANUAL-ADVANCED -->

## 목차

1. [패키지 내용물 확인](#1-패키지-내용물-확인)
2. [하드웨어 조립](#2-하드웨어-조립)
3. [펌웨어 설치](#3-펌웨어-설치)
4. [초기 설정](#4-초기-설정)
5. [동작 확인](#5-동작-확인)

---

## 1. 패키지 내용물 확인

### 1.1 Tally Node TX 키트

> **주의**: 구성 품목은 키트 버전에 따라 다를 수 있습니다. 다음 목록을 확인하세요.

| 품목 | 수량 | 확인 |
|------|------|------|
| **EoRa-S3 기본 보드** | 1개 | [ ] ESP32-S3 + SX1262 통합 보드 |
| **OLED 디스플레이** | 1개 | [ ] 0.96 inch IPS (128x64) |
| **RGB LED** | 1개 | [ ] WS2812B 또는 내장 LED |
| **케이스** | 1세트 | [ ] 3D 프린트된 케이스 (상/하/나사) |
| **전원 어댑터** | 1개 | [ ] USB-C 또는 DC 5V/2A |
| **이더넷 포트** | 1개 | [ ] W5500 이더넷 모듈 (선택) |
| **나사/볼트** | 1세트 | [ ] M2.5, M3 나사 및 스페이서 |

### 1.2 Tally Node RX 키트

| 품목 | 수량 | 확인 |
|------|------|------|
| **EoRa-S3 기본 보드** | 1개 | [ ] ESP32-S3 + SX1262 통합 보드 |
| **OLED 디스플레이** | 1개 | [ ] 0.96 inch IPS (128x64) |
| **RGB LED** | 1개 | [ ] WS2812B 또는 내장 LED |
| **케이스** | 1세트 | [ ] 3D 프린트된 케이스 |
| **배터리 홀더** | 1개 | [ ] 18650 배터리 슬롯 |
| **전원 버튼** | 1개 | [ ] 측면 버튼 또는 상단 버튼 |
| **충전 회로** | 1개 | [ ] TP4056 또는 내장 충전기 |

### 1.3 누락품 신고

누락품이나 파손품이 있을 경우:
- **이메일**: support@tally-node.com
- **GitHub Issues**: https://github.com/your-repo/tally-node/issues
- 주문 번호와 함께 사진을 첨부해 주세요

---

## 2. 하드웨어 조립

### 2.1 케이스 조립

> **팁**: 조립 전에 모든 부품이 손상되지 않았는지 확인하세요.

**TX 장치 조립:**

1. **기본 보드 장착**
   - 케이스 하단 부분을 준비합니다
   - EoRa-S3 보드를 스페이서에 맞춰 놓습니다
   - M2.5 나사로 고정합니다 (4개소)

2. **디스플레이 연결**
   - 디스플레이 FPC 케이블을 보드의 DISPLAY 커넥터에 연결합니다
   - 케이블 잠금장치를 닫습니다
   - 디스플레이를 케이스 전면 홀에 맞춥니다

3. **이더넷 모듈 장착** (TX 전용)
   - W5500 이더넷 모듈을 보드의 이더넷 포트에 납락하거나 커넥터로 연결합니다
   - RJ45 커넥터가 케이스 외부에서 보이도록 배치합니다

4. **케이스 조립**
   - 상단 커버를 덮습니다
   - 나사로 조입니다 (4개소)

**RX 장치 조립:**

1. **기본 보드 장착**
   - 케이스 하단 부분에 보드를 배치합니다
   - 스페이서와 나사로 고정합니다

2. **디스플레이 연결**
   - FPC 케이블을 연결합니다
   - 디스플레이를 전면 홀에 배치합니다

3. **배터리 홀더 연결**
   - 18650 배터리 홀더를 배터리 컴파트먼트에 배치합니다
   - 배터리 커넥터를 보드의 BATT 포트에 연결합니다

4. **전원 버튼 장착**
   - 버튼을 측면 홀에 맞춰 배치합니다
   - 버튼 스위치를 보드의 POWER 핀에 납락하거나 연결합니다

5. **충전 포트 장착**
   - Type-C 포트를 케이스 충전 홀에 맞춥니다
   - 충전 회로와 연결합니다

### 2.2 배터리 연결 (RX만 해당)

> **경고**: 배터리 연결 시 극성을 확인하세요. 반대 연결 시 회로 손상이 발생할 수 있습니다.

**단계:**

1. 18650 리튬이온 배터리를 준비합니다
2. 배터리 홀더에 **+극(볼록한 쪽)이 위쪽**을 향하도록 삽입합니다
3. "딸깍" 소리가 날 때까지 밀어 넣습니다
4. 배터리가 흔들리지 않는지 확인합니다

### 2.3 디스플레이 연결

**FPC 케이블 연결 방법:**

1. 커넥터의 잠금장치를 들어 올립니다
2. FPC 케이블을 커넥터에 끼웁니다 (금형 접점이 아래로)
3. 잠금장치를 내려서 고정합니다

**연결 확인:**
- 케이블이 구겨지지 않았는지 확인합니다
- 디스플레이가 수평인지 확인합니다

---

## 3. 펌웨어 설치

### 3.1 PlatformIO 설치

> **요구사항**: Arduino IDE 2.x 또는 PlatformIO가 필요합니다.

#### 옵션 A: PlatformIO (권장)

**VS Code 확장 설치:**

1. VS Code를 엽니다
2. 왼쪽 확장 아이콘을 클릭합니다
3. "PlatformIO"를 검색합니다
4. **Install** 버튼을 클릭합니다

#### 옵션 B: Arduino IDE

**Arduino IDE 설치:**

1. https://www.arduino.cc/en/software 에서 다운로드
2. 설치 후 ESP32 보드 매니저 추가:
   - 파일 > 환경설정
   - 추가 보드 매니저 URL: `https://espressif.github.io/arduino-esp32/package_esp32_index.json`
3. 도구 > 보드 > 보드 매니저
4. "esp32" 검색 후 ESP32 by Espressif Systems 설치

### 3.2 소스 코드 다운로드

**Git 클론:**

```bash
git clone https://github.com/your-repo/tally-node.git
cd tally-node
```

**또는 ZIP 다운로드:**

1. https://github.com/your-repo/tally-node 에 접속
2. **Code** > **Download ZIP** 클릭
3. 압축 해제

### 3.3 펌웨어 빌드 및 업로드

#### PlatformIO 사용 (권장)

**빌드:**

```bash
cd tally-node
pio run --environment tx   # TX 모드 빌드
# 또는
pio run --environment rx   # RX 모드 빌드
```

**업로드:**

1. USB-C 케이블로 장치를 컴퓨터에 연결합니다
2. 장치가 부팅될 때까지 기다립니다 (3초)
3. 업로드 명령 실행:

```bash
pio run --target upload --environment tx   # TX 업로드
# 또는
pio run --target upload --environment rx   # RX 업로드
```

**예상 결과:**
```
Writing at 0x00001000... (100%)
Wrote 123456 bytes (56789 compressed) at 0x00010000 in 2.3 seconds...
========================================================= [SUCCESS] Took 15.67 seconds =========================================================
```

#### Arduino IDE 사용

**업로드:**

1. `tally-node/tally_tx.ino` 또는 `tally_rx.ino`를 엽니다
2. 도구 > 보드 > ESP32S3 Dev Module 선택
3. 도구 > 포트에서 장치 포트 선택 (예: COM3 또는 /dev/ttyUSB0)
4. 업로드 버튼 클릭 (→)

### 3.4 업로드 확인

**업로드 성공 확인:**

1. 시리얼 모니터를 엽니다 (PlatformIO: `pio device monitor`)
2. 보드 속도: 115200
3. 장치를 재시작합니다 (재시작 버튼 또는 전원 재연결)

**부팅 로그 예시:**

```
rst:0x1 (POWERON_RESET),boot:0x13 (SPI_FAST_FLASH_BOOT)
configsip: 0, SPIWP:0xee
clk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00
mode:DIO, clock div:2
load:0x3fff0030,len:1184
load:0x40078000,len:13232
ho 0 tail 12 room 4
load:0x40080400,len:3076
entry 0x40080598

Tally Node TX v1.0.0
Initializing LoRa... OK (SX1262)
Initializing Ethernet... OK (IP: 192.168.1.100)
Initializing Display... OK
Starting web server... OK
```

---

## 4. 초기 설정

### 4.1 전원 켜기

**TX 장치 전원 켜기:**

1. USB-C 케이블을 컴퓨터 또는 5V 어댑터에 연결합니다
2. 전원 LED가 녹색으로 켜지는지 확인합니다

**RX 장치 전원 켜기:**

1. 배터리를 장착합니다
2. 측면 전원 버튼을 2초간 길게 누릅니다
3. 디스플레이에 로고가 표시됩니다

### 4.2 WiFi AP 모드 연결

처음 설정은 WiFi AP 모드를 통해 진행됩니다.

**AP 모드 접속:**

1. 장치 전원을 켭니다
2. 스마트폰/컴퓨터의 WiFi 목록에서 **"TallyNode-XXXX"**를 찾습니다
3. 연결합니다 (비밀번호 없음 또는 기본 비밀번호: `12345678`)
4. 브라우저가 자동으로 설정 페이지로 이동합니다

**또는 수동 접속:**
- 브라우저 주소창에 `http://192.168.4.1` 입력

### 4.3 기본 설정 완료

**설정 페이지:**

1. **WiFi 설정**
   - 사용할 WiFi 네트워크 SSID 선택
   - WiFi 비밀번호 입력
   - **[저장]** 클릭

2. **장치 모드 선택**
   - TX 모드 또는 RX 모드 선택
   - 카메라 ID 입력 (RX 모드인 경우)
   - **[저장]** 클릭

3. **재시작**
   - 장치가 자동으로 재시작됩니다
   - 이제 설정된 WiFi에 연결됩니다

### 4.4 IP 주소 확인

**장치 IP 확인 방법:**

1. **mDNS 사용 (권장):**
   ```bash
   ping tallynode-tx.local  # TX
   ping tallynode-rx.local  # RX
   ```

2. **라우터 DHCP 목록:**
   - 라우터 관리 페이지 접속
   - 연결된 장치 목록에서 "TallyNode" 확인

3. **시리얼 모니터:**
   - USB 연결 후 시리얼 모니터 확인
   - 부팅 로그에 IP 표시됨

---

## 5. 동작 확인

### 5.1 TX 모드 테스트

**기본 동작 확인:**

1. 웹브라우저로 TX 웹 UI 접속: `http://tallynode-tx.local`
2. 대시보드가 정상 표시되는지 확인합니다

**스위처 연결 테스트:**

1. 웹 UI에서 **[설정]** > **[스위처]** 이동
2. 스위처 유형 선택 (ATEM 또는 vMix)
3. IP 주소 입력
4. **[연결 테스트]** 클릭
5. 연결 성공 메시지 확인

**LoRa 송신 테스트:**

1. RX 장치를 준비합니다
2. TX 장치에서 테스트 Tally 전송:
   - 웹 UI에서 **[테스트]** > **[Tally 전송]**
   - 채널 1 Program 선택
   - **[전송]** 클릭
3. RX 장치에서 적색 LED가 켜지는지 확인합니다

### 5.2 RX 모드 테스트

**기본 동작 확인:**

1. 전원을 켭니다
2. 디스플레이 로고가 표시되는지 확인합니다
3. 카메라 ID가 표시되는지 확인합니다

**LoRa 수신 테스트:**

1. TX 장치를 켭니다
2. TX에서 테스트 Tally 전송 (위 참조)
3. RX 장치 확인:
   - Program LED (적색)이 켜지는지?
   - 디스플레이에 "● PROGRAM"이 표시되는지?

**RSSI 확인:**

1. RX 디스플레이에서 RSSI 값 확인 (예: `-65 dBm`)
2. TX 장치를 멀리 이동하며 RSSI 변화 확인

### 5.3 완전 시스템 테스트

**종합 테스트 시나리오:**

1. **준비**
   - TX 장치: 스위처 연결 완료
   - RX 장치 3대: 각각 ID 1, 2, 3 설정

2. **테스트**
   - 스위처에서 입력 1을 Program으로 전환
   - RX(ID=1)에 적색 LED 켜짐 확인
   - 스위처에서 입력 2를 Preview로 전환
   - RX(ID=2)에 녹색 LED 켜짐 확인

3. **결과**
   - 모든 RX가 올바른 Tally를 수신하면 성공!
   - 문제가 있으면 [문제 해결 가이드](troubleshooting-guide.md) 참조

---

## 다음 단계

- [ ] [TX 모드 가이드](tx-mode-guide.md) - TX 장치 상세 사용법
- [ ] [RX 모드 가이드](rx-mode-guide.md) - RX 장치 상세 사용법
- [ ] [고급 설정 가이드](advanced-guide.md) - LoRa 파라미터 최적화

---

## 문제 해결

설치 중 문제가 발생하면:

1. **펌웨어 업로드 실패**
   - USB 포트 확인
   - 드라이버 설치 (CP2102 or CH340)
   - 부트 모드 진입 (BOOT 버튼 누른 상태에서 재시작)

2. **WiFi 연결 안 됨**
   - AP 모드로 재진입 (전원 껐다 켬기)
   - 설정 초기화 (설정 > 초기화)

3. **디스플레이 안 켜짐**
   - FPC 케이블 재연결
   - 전원 확인

---

## 추가 지원

매뉴얼에 대한 피드백이나 추가 지원이 필요하시면:
- **GitHub Issues**: https://github.com/your-repo/tally-node/issues
- **디스코드 커뮤니티**: https://discord.gg/tally-node

---

**문서 버전**: 1.0.0
**최종 업데이트**: 2026-01-19
**작성자**: Tally Node 팀
