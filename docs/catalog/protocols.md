# 프로토콜 지원 카탈로그

Tally Node가 지원하는 모든 스위처 프로토콜과 통신 방식을 문서화합니다.

## 개요

| 항목 | 값 |
|------|------|
| 지원 프로토콜 | ATEM, vMix, OBS (개발 중) |
| 통신 방식 | UDP, TCP, WebSocket |
| 최대 채널 | 20채널 |
| Tally 타입 | Program, Preview |

---

## 1. ATEM Protocol

### 개요

Blackmagic Design ATEM 스위처용 UDP 기반 프로토콜입니다.

| 항목 | 값 |
|------|------|
| 프로토콜 | UDP |
| 포트 | 9910 (표준 포트) |
| 상태 | ✅ 지원 |
| 안정성 | 높음 |

### 사양

| 항목 | 값 | 설명 |
|------|------|------|
| **프로토콜** | UDP | Blackmagic ATEM |
| **포트** | 9910 | 표준 포트 |
| **상태** | ✅ 지원 | 안정적 동작 |
| **최대 채널** | 20 | 지원 카메라 수 |
| **Tally 타입** | Program/Preview | 모두 지원 |
| **패킷 구조** | 헤더 + 길이 + 명령어 + 페이로드 | ATEM 패킷 형식 |
| **연결 유지** | 주기적 하트비트 | ping-pong |

### 지원 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| **Tally 상태 수신** | ✅ 지원 | Program/Preview 상태 수신 |
| **연결 상태 모니터링** | ✅ 지원 | 실시간 연결 상태 표시 |
| **자동 재연결** | ✅ 지원 | 연결 끊김 시 자동 재연결 |
| **미디어 클립 정보** | 📋 계획 | 미디어 클립 상태 정보 (계획) |
| **장면 전환 감지** | 📋 계획 | 장면 전환 이벤트 감지 (계획) |

### 지원 모델

| 시리즈 | 지원 여부 | 비고 |
|--------|-----------|------|
| **ATEM Mini** | ✅ 지원 | Pro, Extreme, ISO 모두 지원 |
| **ATEM Television Studio** | ✅ 지원 | HD, 4K, 8K 모두 지원 |
| **ATEM Production Studio** | ✅ 지원 | 4K, 4K Constellation 모두 지원 |
| **ATEM Switcher** | ✅ 지원 | 모델 제약 없음 |

### 통신 특성

| 항목 | 값 |
|------|------|
| **패킷 크기** | 가변 (최대 1,500 바이트) |
| **전송 간격** | 상태 변경 시 즉시 |
| **하트비트** | 약 1초 간격 |
| **대기 시간** | < 100ms |

---

## 2. vMix Protocol

### 개요

vMix용 TCP 기반 텍스트 프로토콜입니다.

| 항목 | 값 |
|------|------|
| 프로토콜 | TCP |
| 포트 | 8099 (표준 포트) |
| 상태 | ✅ 지원 |
| 안정성 | 높음 |

### 사양

| 항목 | 값 | 설명 |
|------|------|------|
| **프로토콜** | TCP | vMix Controller |
| **포트** | 8099 | 표준 포트 |
| **상태** | ✅ 지원 | 안정적 동작 |
| **최대 채널** | 20 | 지원 카메라 수 |
| **Tally 타입** | Program/Preview | 모두 지원 |
| **명령 형식** | 텍스트 기반 | 줄바꿈로 구분 |
| **연결 유지** | 주기적 PING | 약 5초 간격 |

### 지원 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| **Tally XML 구독** | ✅ 지원 | `SUBSCRIBE TALLY` 명령 |
| **PING 유지** | ✅ 지원 | 연결 유지용 주기적 PING |
| **자동 재연결** | ✅ 지원 | 연결 끊김 시 자동 재연결 |
| **출력 상태 정보** | 📋 계획 | Program/Preview 출력 상태 (계획) |
| **녹화 상태** | 📋 계획 | 녹화 중/정지 상태 (계획) |

### 명령 예시

```
# Tally 정보 구독
SUBSCRIBE TALLY

# PING (연결 유지)
PING

# 응답 예시
TALLY OK
```

### 통신 특성

| 항목 | 값 |
|------|------|
| **패킷 크기** | 가변 (텍스트 기반) |
| **전송 간격** | 상태 변경 시 즉시 |
| **PING 간격** | 약 5초 |
| **대기 시간** | < 50ms |

---

## 3. OBS Protocol

### 개요

OBS Studio용 WebSocket 기반 프로토콜입니다. 현재 개발 중입니다.

| 항목 | 값 |
|------|------|
| 프로토콜 | WebSocket |
| 포트 | 4455 (표준 포트) |
| 상태 | 🔄 개발 중 |
| 안정성 | 베타 테스트 중 |

### 사양

| 항목 | 값 | 설명 |
|------|------|------|
| **프로토콜** | WebSocket | OBS WebSocket |
| **포트** | 4455 | 표준 포트 |
| **상태** | 🔄 개발 중 | 베타 테스트 |
| **최대 채널** | 20 | 지원 카메라 수 |
| **Tally 타입** | Program/Preview | 모두 지원 |
| **메시지 형식** | JSON | 요청/응답 형식 |
| **연결 유지** | WebSocket Keep-Alive | |

### 지원 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| **연결 관리** | ✅ 지원 | WebSocket 연결 및 인증 |
| **Tally 수신** | 🔄 개발 중 | Scene Item 정보 수신 중 |
| **자동 재연결** | 📋 계획 | 연결 끊김 시 자동 재연결 (계획) |
| **장면 전환 감지** | 📋 계획 | 장면 전환 이벤트 감지 (계획) |
| **녹화/스트리밍 상태** | 📋 계획 | 녹화/스트리밍 상태 (계획) |

### 개발 로드맵

| 단계 | 기능 | 상태 |
|------|------|------|
| **Phase 1** | WebSocket 연결 및 인증 | ✅ 완료 |
| **Phase 2** | Tally 정보 수신 | 🔄 진행 중 |
| **Phase 3** | 자동 재연결 | 📋 계획 |
| **Phase 4** | 장면 전환 감지 | 📋 계획 |

### 통신 특성

| 항목 | 값 |
|------|------|
| **메시지 형식** | JSON |
| **전송 간격** | 상태 변경 시 즉시 |
| **Keep-Alive** | WebSocket 표준 |
| **대기 시간** | < 100ms (예상) |

---

## 4. LoRa Protocol

### 개요

커스텀 LoRa 데이터 링크 프로토콜입니다.

| 항목 | 값 |
|------|------|
| 프로토콜 | 커스텀 LoRa |
| 주파수 | 923MHz (한국) |
| 상태 | ✅ 지원 |

### 사양

| 항목 | 값 | 설명 |
|------|------|------|
| **프로토콜** | 커스텀 LoRa | |
| **주파수** | 923MHz | 한국 대역 |
| **대역폭** | 125kHz (기본) | 가변 |
| **확장 인자(SF)** | 9 (기본) | 7-12 가변 |
| **패킷 구조** | [HEADER][TYPE][LENGTH][PAYLOAD][CRC] | |
| **암호화** | AES-128 | 라이선스 기반 |
| **압축** | Packed Data | 채널당 2비트 |

### 패킷 구조

```
+--------+------+--------+---------+-----+
| HEADER | TYPE | LENGTH | PAYLOAD | CRC |
+--------+------+--------+---------+-----+
  1 바이트   1바이트  1바이트   가변    2바이트
```

| 필드 | 크기 | 설명 |
|------|------|------|
| **HEADER** | 1바이트 | 패킷 식별자 (0xAA) |
| **TYPE** | 1바이트 | 메시지 타입 |
| **LENGTH** | 1바이트 | 페이로드 길이 |
| **PAYLOAD** | 가변 | 데이터 |
| **CRC** | 2바이트 | CRC-16 체크섬 |

### 메시지 타입

| 타입 | 값 | 설명 |
|------|-----|------|
| **MSG_TALLY** | 0x01 | Tally 정보 |
| **MSG_STATUS_REQ** | 0x02 | 상태 요청 |
| **MSG_STATUS_RESP** | 0x03 | 상태 응답 |
| **MSG_ACK** | 0x04 | 확인 응답 |

### 데이터 압축

Packed Data 형식으로 Tally 정보 압축:

| 채널 수 | 비트 수 | 바이트 수 |
|---------|---------|-----------|
| 8 | 16 | 2 |
| 16 | 32 | 4 |
| 20 | 40 | 5 |

### 통신 특성

| 항목 | 값 |
|------|------|
| **통신 거리** | 최대 수km (환경 의존) |
| **전송 전력** | -9 ~ 22dBm |
| **대기 시간** | < 1초 |
| **암호화** | AES-128 (옵션) |

---

## 5. 프로토콜 비교

| 항목 | ATEM | vMix | OBS |
|------|------|------|-----|
| **프로토콜** | UDP | TCP | WebSocket |
| **포트** | 9910 | 8099 | 4455 |
| **상태** | ✅ 지원 | ✅ 지원 | 🔄 개발 중 |
| **안정성** | 높음 | 높음 | 베타 |
| **최대 채널** | 20 | 20 | 20 |
| **Tally 타입** | PVW/PGM | PVW/PGM | PVW/PGM |
| **자동 재연결** | ✅ | ✅ | 📋 |

---

## 6. 네트워크 프로토콜

### 지원 프로토콜

| 프로토콜 | 포트 | 용도 | 상태 |
|----------|------|------|------|
| **HTTP** | 80 | 웹 설정 서버 | ✅ 지원 |
| **mDNS** | 5353 | 로컬 서비스 디스커버리 | ✅ 지원 |
| **UDP** | 9910 | ATEM 통신 | ✅ 지원 |
| **TCP** | 8099 | vMix 통신 | ✅ 지원 |
| **WebSocket** | 4455 | OBS 통신 | 🔄 개발 중 |
| **HTTPS** | 443 | 보안 웹 서버 | 📋 계획 |

### 네트워크 인터페이스

| 인터페이스 | 속도 | 상태 |
|-----------|------|------|
| **WiFi (STA)** | 802.11 b/g/n | ✅ 지원 |
| **WiFi (AP)** | 802.11 b/g/n | ✅ 지원 |
| **Ethernet** | 100Mbps (W5500) | ✅ 지원 |

---

## 관련 문서

- [하드웨어 카탈로그](hardware.md)
- [소프트웨어 기능 카탈로그](software-features.md)
- [구성 옵션 카탈로그](configuration.md)
- [기술 스택 문서](../.moai/project/tech.md)

---

**태그**: `PROTO-CATALOG-ATEM`, `PROTO-CATALOG-VMIX`, `PROTO-CATALOG-OBS`
**요구사항**: REQ-CATALOG-010, REQ-CATALOG-011, REQ-CATALOG-012, REQ-CATALOG-013
