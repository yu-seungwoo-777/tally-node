# 소프트웨어 기능 카탈로그

Tally Node의 모든 소프트웨어 기능과 모듈을 문서화합니다.

## 개요

| 항목 | 값 |
|------|------|
| 펌웨어 | ESP-IDF 5.5.0 기반 C/C++ |
| 웹 UI | Alpine.js + TailwindCSS + DaisyUI |
| 아키텍처 | 5계층 컴포넌트 구조 |

---

## 1. TX 모드 기능

### 개요

TX 모드는 비디오 스위처에 연결하여 Tally 정보를 수집하고 LoRa로 무선 전송하는 기능을 제공합니다.

| 항목 | 값 |
|------|------|
| 카테고리 | 소프트웨어 기능 |
| 상태 | ✅ 지원 |
| 최종 업데이트 | 2026-01-19 |

### 기능 목록

| 기능 | 설명 | 상태 |
|------|------|------|
| **스위처 연결** | ATEM/vMix/OBS 스위처 연결 | ✅ 지원 |
| **듀얼모드** | Primary/Secondary 스위처 동시 지원 | ✅ 지원 |
| **Tally 수집** | 스위처에서 Tally 정보 수집 | ✅ 지원 |
| **LoRa 송신** | Tally 정보 무선 전송 | ✅ 지원 |
| **웹 서버** | 설정 및 모니터링 UI | ✅ 지원 |
| **디바이스 관리** | RX 장치 상태 모니터링 | ✅ 지원 |
| **상태 요청** | 주기적/즉시 상태 요청 | ✅ 지원 |
| **Tally UI 표시** | 디스플레이에 현재 Tally 상태 표시 | ✅ 지원 |

### 상세 기능 설명

#### 1.1 스위처 연결

| 프로토콜 | 포트 | 상태 | 설명 |
|----------|------|------|------|
| **ATEM** | UDP 9910 | ✅ 지원 | Blackmagic ATEM 스위처 |
| **vMix** | TCP 8099 | ✅ 지원 | vMix 소프트웨어 스위처 |
| **OBS** | WebSocket 4455 | 🔄 개발 중 | OBS Studio (베타 테스트) |

#### 1.2 듀얼모드 (Dual Switcher)

- **Primary 스위처**: 메인 스위처의 Tally 정보 사용
- **Secondary 스위처**: 백업 스위처의 Tally 정보 사용
- **자동 전환**: Primary 장애 시 Secondary 자동 전환
- **동시 모니터링**: 두 스위처의 상태 실시간 감시

#### 1.3 Tally UI 표시 (최신 기능)

- **실시간 모니터링**: TX 모드에서 현재 Tally 상태를 실시간으로 표시
- **채널별 상태**: 모든 카메라 채널의 Program/Preview 상태를 한눈에 확인
- **그리드 레이아웃**: 20채널까지 4x5 그리드로 표시
- **스크롤 지원**: 20채널 초과 시 스크롤 가능

### 주요 특징

- **자동 재연결**: 연결 끊김 시 자동으로 재연결 시도
- **연결 상태 모니터링**: 실시간 연결 상태 표시
- **실시간 Tally 전송**: 상태 변경 시 즉시 LoRa 송신

---

## 2. RX 모드 기능

### 개요

RX 모드는 LoRa로 Tally 정보를 수신하여 LED와 디스플레이에 표시하는 기능을 제공합니다.

| 항목 | 값 |
|------|------|
| 카테고리 | 소프트웨어 기능 |
| 상태 | ✅ 지원 |
| 최종 업데이트 | 2026-01-19 |

### 기능 목록

| 기능 | 설명 | 상태 |
|------|------|------|
| **LoRa 수신** | Tally 정보 수신 | ✅ 지원 |
| **LED 표시** | Program/Preview LED 표시 | ✅ 지원 |
| **디스플레이** | 상태 정보 표시 | ✅ 지원 |
| **배터리 모니터링** | 잔량 및 저전량 경고 | ✅ 지원 |
| **카메라 ID** | 1-20 할당 | ✅ 지원 |
| **상태 응답** | TX 요청 시 상태 송신 | ✅ 지원 |
| **Deep Sleep** | 저전력 모드 | ✅ 지원 |
| **배터리 Empty 페이지** | 저전량 3-state 디스플레이 | ✅ 지원 |

### 상세 기능 설명

#### 2.1 LED 표시

| 상태 | LED | 색상 |
|------|-----|------|
| **Program** | PGM (빨간색) | 빨강 (R:255, G:0, B:0) |
| **Preview** | PVW (녹색) | 초록 (R:0, G:255, B:0) |
| **Safe** | 모두 꺼짐 | 꺼짐 |

#### 2.2 디스플레이 페이지 구조

| 페이지 | 용도 | 내용 |
|--------|------|------|
| **BootPage** | 부팅 화면 | 로고, 초기화 메시지 |
| **RxPage** | RX 모드 페이지 | 채널 번호, PVW/PGM 상태, 프로그램 이름, RSSI, 배터리 |
| **EmptyPage** | 배터리 Empty | 저전량 경고, 깜빡임 애니메이션 |

#### 2.3 배터리 Empty 페이지 (최신 기능)

- **3-state 디스플레이**: 빨간색 → 깜빡임 → 꺼짐
- **자동 전환**: 배터리 잔량 15% 미만시 자동 활성화
- **Deep Sleep 카운트다운**: 30초 카운트다운 후 Deep Sleep 진입
- **깜빡임 로직**: 빨간색 아이콘과 텍스트 0.5초 간격 깜빡임

### 주요 특징

- **실시간 수신**: LoRa 패킷 수신 후 즉시 표시
- **우선순위 최적화**: LoRa 수신 태스크 우선순위 8로 상향
- **저전력**: 미사용 시 Deep Sleep 모드 진입
- **상태 응답**: TX 요청 시 배터리, RSSI 등 상태 정보 송신

---

## 3. 웹 UI 기능

### 개요

웹 UI는 WiFi/Ethernet 연결 시 자동으로 시작되는 웹 기반 설정 인터페이스입니다.

| 항목 | 값 |
|------|------|
| 카테고리 | 웹 인터페이스 |
| 상태 | ✅ 지원 |
| 기술 스택 | Alpine.js + TailwindCSS + DaisyUI |

### 기능 목록

| 기능 | 설명 | 상태 |
|------|------|------|
| **대시보드** | 실시간 상태 모니터링 | ✅ 지원 |
| **네트워크 설정** | WiFi/Ethernet 설정 | ✅ 지원 |
| **스위처 설정** | ATEM/vMix/OBS 설정 | ✅ 지원 |
| **LoRa 설정** | RF 파라미터 설정 | ✅ 지원 |
| **디바이스 관리** | RX 장치 목록 및 상태 | ✅ 지원 |
| **시스템 정보** | 펌웨어/라이선스 정보 | ✅ 지원 |
| **실시간 업데이트** | SSE 기반 상태 업데이트 | ✅ 지원 |
| **라이선스 키 보호** | 가리기/보기 기능 | ✅ 지원 |

### 상세 기능 설명

#### 3.1 대시보드

| 항목 | 설명 |
|------|------|
| **연결 상태** | 스위처, 네트워크 연결 상태 |
| **Tally 상태** | 모든 채널의 PVW/PGM 상태 |
| **RX 장치 상태** | 연결된 RX 장치 목록 및 상태 |
| **시스템 정보** | 펌웨어 버전, 라이선스 상태 |

#### 3.2 네트워크 설정

| 설정 항목 | 설명 |
|-----------|------|
| **WiFi AP/STA** | AP 모드 또는 STA 모드 선택 |
| **WiFi SSID** | 연결할 WiFi 네트워크 이름 |
| **WiFi 비밀번호** | WPA2 비밀번호 (8-64자) |
| **IP 할당 방식** | DHCP 또는 Static IP |
| **고정 IP** | x.x.x.x 형식 |
| **서브넷 마스크** | x.x.x.x 형식 |
| **게이트웨이** | x.x.x.x 형식 |
| **DNS** | x.x.x.x 형식 |
| **Ethernet** | W5500 Ethernet 사용 여부 |

#### 3.3 스위처 설정

| 설정 항목 | 설명 |
|-----------|------|
| **Primary 스위처** | 메인 스위처 설정 |
| **Secondary 스위처** | 백업 스위처 설정 |
| **프로토콜 선택** | ATEM, vMix, OBS |
| **IP 주소** | 스위처 IP 주소 |
| **포트** | 프로토콜 포트 (자동 설정) |

#### 3.4 LoRa 설정

| 설정 항목 | 범위 | 기본값 |
|-----------|------|--------|
| **주파수(MHz)** | 920-928 | 923.0 |
| **SF** | 7-12 | 9 |
| **대역폭(kHz)** | 125, 250, 500 | 125 |
| **CR** | 5-8 | 5 |
| **출력 전력(dBm)** | -9 ~ 22 | 17 |

#### 3.5 디바이스 관리

| 항목 | 설명 |
|------|------|
| **RX 장치 목록** | 연결된 모든 RX 장치 |
| **장치 상태** | 배터리, RSSI, 마지막 통신 시간 |
| **상태 요청** | 즉시 상태 정보 요청 |

#### 3.6 라이선스 키 보안 (최신 기능)

- **가리기 기능**: 라이선스 키 마스킹 (******)
- **보기 기능**: 클릭하여 키 전체 표시
- **보안 강화**: UI에서 키 노출 방지

### 주요 특징

- **반응형 UI**: 모바일/데스크톱 지원
- **실시간 업데이트**: SSE(Server-Sent Events) 기반 상태 업데이트
- **다국어 지원**: 한국어/영어 지원
- **모던 디자인**: DaisyUI 컴포넌트 기반

---

## 4. 시스템 기능

### 개요

시스템 기능은 Tally Node의 핵심 인프라와 유틸리티를 제공합니다.

| 항목 | 값 |
|------|------|
| 카테고리 | 시스템 인프라 |
| 상태 | ✅ 지원 |
| 아키텍처 | 5계층 구조 |

### 기능 목록

| 기능 | 설명 | 상태 |
|------|------|------|
| **이벤트 버스** | Pub/Sub 메시징 | ✅ 지원 |
| **로깅** | 구조화된 로깅 | ✅ 지원 |
| **설정 저장** | NVS 기반 영구 저장 | ✅ 지원 |
| **OTA 업데이트** | 무선 펌웨어 업데이트 | 📋 계획 |
| **라이선스 관리** | 라이선스 검증 | ✅ 지원 |

### 상세 기능 설명

#### 4.1 이벤트 버스

| 특징 | 설명 |
|------|------|
| **Pub/Sub 패턴** | 컴포넌트 간 느슨한 결합 |
| **이벤트 타입** | 30+ 이벤트 타입 지원 |
| **우선순위** | RX 모드에서 우선순위 8로 동작 |

#### 4.2 로깅

| 레벨 | 설명 |
|------|------|
| **ERROR** | 오류 메시지 |
| **WARN** | 경고 메시지 |
| **INFO** | 정보 메시지 |
| **DEBUG** | 디버그 메시지 |

#### 4.3 설정 저장 (NVS)

| 카테고리 | 항목 |
|----------|------|
| **WiFi 설정** | SSID, 비밀번호, IP 설정 |
| **Ethernet 설정** | IP 설정, 사용 여부 |
| **스위처 설정** | Primary/Secondary 스위처 정보 |
| **LoRa 설정** | RF 파라미터 |
| **디바이스 설정** | 밝기, 카메라 ID |
| **LED 설정** | Program/Preview 색상 |

#### 4.4 라이선스 관리

| 기능 | 설명 |
|------|------|
| **라이선스 검증** | 정품 라이선스 확인 |
| **암호화 통신** | 라이선스 기반 LoRa 암호화 |
| **키 보호** | UI에서 키 마스킹/표시 전환 |

### 주요 특징

- **5계층 아키텍처**: 앱 → 프레젠테이션 → 서비스 → 드라이버 → HAL
- **FreeRTOS**: 각 서비스는 독립 태스크
- **이벤트 기반 통신**: 컴포넌트 간 느슨한 결합

---

## 관련 문서

- [하드웨어 카탈로그](hardware.md)
- [프로토콜 지원 카탈로그](protocols.md)
- [구성 옵션 카탈로그](configuration.md)
- [아키텍처 문서](../ARCHITECTURE.md)

---

**태그**: `SW-CATALOG-TX`, `SW-CATALOG-RX`, `SW-CATALOG-WEB`, `SW-CATALOG-SYSTEM`
**요구사항**: REQ-CATALOG-006, REQ-CATALOG-007, REQ-CATALOG-008, REQ-CATALOG-009
